

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Handlers &mdash; Akka Documentation</title>
    
    <link rel="stylesheet" href="../../../_static/style.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/prettify.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/base.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/docs.css" type="text/css" />
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700" type="text/css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '2.4.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/toc.js"></script>
    <script type="text/javascript" src="../../../_static/prettify.js"></script>
    <script type="text/javascript" src="../../../_static/highlightCode.js"></script>
    <script type="text/javascript" src="../../../_static/effects.core.js"></script>
    <script type="text/javascript" src="../../../_static/effects.highlight.js"></script>
    <script type="text/javascript" src="../../../_static/scrollTo.js"></script>
    <script type="text/javascript" src="../../../_static/contentsFix.js"></script>
    <script type="text/javascript" src="../../../_static/ga.js"></script>
    <script type="text/javascript" src="../../../_static/warnOldDocs.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="top" title="Akka Documentation" href="../../../index.html" />
    <link rel="up" title="High-level Server-Side API" href="index.html" />
    <link rel="next" title="Marshalling &amp; Unmarshalling" href="marshalling.html" />
    <link rel="prev" title="Request Values: OAuth 2 Bearer Token Authentication" href="request-vals/oauth2-authenticator.html" />


  </head>
  <body>
  <div class="navbar">
    <div class="navbar-inner">
      <div class="container">
        <div class="navbar-logo">
          <a href="http://akka.io"><img class="svg-logo" src="../../../_static/akka_full_color.svg" /></a>
        </div>    
        <ul class="nav">
          <li><a href="http://akka.io/docs">Documentation</a></li>
          <li><a href="http://akka.io/faq">FAQ</a></li>
          <li><a href="http://akka.io/downloads">Download</a></li>
          <li><a href="http://groups.google.com/group/akka-user">Mailing List</a></li>
          <li><a href="http://github.com/akka/akka">Code</a></li>           
          <li><a href="http://www.lightbend.com/how/subscription">Commercial Support</a></li>
        </ul>
      </div>
    </div>
  </div>
  <div class="main">
    <div class="container">
      <div class="page-title">Handlers</div>
      <div class="pdf-link"><a href="../../../AkkaScala.pdf" title="Akka Scala Documentation"><img src="../../../_static/pdf-scala-icon.png" style="height: 40px;" /></a></div>
      <div class="pdf-link"><a href="../../../AkkaJava.pdf" title="Akka Java Documentation"><img src="../../../_static/pdf-java-icon.png" style="height: 40px;" /></a></div>
    </div>
    <div class="main-container">
      <div class="container">
        <div class="row">
          <div class="span12">
            <ul class="breadcrumb">           
              <li>
                 <span class="divider">|</span> <a href="marshalling.html">Marshalling &amp; Unmarshalling</a> <span class="divider">»</span>
              </li>
              <li>
                <a href="../../../java.html">Java Contents</a> <span class="divider">|</span> <a href="../../../scala.html">Scala Contents</a>
              </li>
              <li>
                <span class="divider">«</span> <a href="request-vals/oauth2-authenticator.html">Request Values: OAuth 2 Bearer Token Authentication</a> <span class="divider">|</span>
              </li>
              <li style="float: left">
                Version 2.4.3
              </li>
              <li style="float: left">
                <input type="search" id="search" class="form-control" />
              </li>
            </ul>
          </div>
        </div>
        <div class="row"><div class="span9">
            
  <div class="section" id="handlers">
<span id="handlers-java"></span><h1>Handlers</h1>
<p>Handlers implement the actual application-defined logic for a certain trace in the routing tree. Most of the leaves of
the routing tree will be routes created from handlers. Creating a <tt class="docutils literal"><span class="pre">Route</span></tt> from a handler is achieved using the
<tt class="docutils literal"><span class="pre">BasicDirectives.handleWith</span></tt> overloads. They come in several forms:</p>
<ul class="simple">
<li>with a single <tt class="docutils literal"><span class="pre">Handler</span></tt> argument and a variable number of <tt class="docutils literal"><span class="pre">RequestVal&lt;?&gt;</span></tt> (may be 0)</li>
<li>with a number <tt class="docutils literal"><span class="pre">n</span></tt> of <tt class="docutils literal"><span class="pre">RequestVal&lt;T1&gt;</span></tt> arguments and a <tt class="docutils literal"><span class="pre">HandlerN&lt;T1,</span> <span class="pre">..,</span> <span class="pre">TN&gt;</span></tt> argument</li>
<li>with a <tt class="docutils literal"><span class="pre">Class&lt;?&gt;</span></tt> and/or instance and a method name String argument and a variable number of <tt class="docutils literal"><span class="pre">RequestVal&lt;?&gt;</span></tt> (may be 0)
arguments</li>
</ul>
<div class="section" id="simple-handler">
<h2>Simple Handler</h2>
<p>In its simplest form a <tt class="docutils literal"><span class="pre">Handler</span></tt> is a SAM class that defines application behavior
by inspecting the <tt class="docutils literal"><span class="pre">RequestContext</span></tt> and returning a <tt class="docutils literal"><span class="pre">RouteResult</span></tt>:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">trait</span> <span class="nc">Handler</span> <span class="k">extends</span> <span class="n">akka</span><span class="o">.</span><span class="n">japi</span><span class="o">.</span><span class="n">function</span><span class="o">.</span><span class="nc">Function</span><span class="o">[</span><span class="kt">RequestContext</span>, <span class="kt">RouteResult</span><span class="o">]</span> <span class="o">{</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">apply</span><span class="o">(</span><span class="n">ctx</span><span class="k">:</span> <span class="kt">RequestContext</span><span class="o">)</span><span class="k">:</span> <span class="kt">RouteResult</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Such a handler inspects the <tt class="docutils literal"><span class="pre">RequestContext</span></tt> it receives and uses the <tt class="docutils literal"><span class="pre">RequestContext</span></tt>'s methods to
create a response:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="nc">Handler</span> <span class="n">handlerString</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Handler</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">static</span> <span class="k">final</span> <span class="n">long</span> <span class="n">serialVersionUID</span> <span class="k">=</span> <span class="mi">1L</span><span class="o">;</span>
    <span class="nd">@Override</span>
    <span class="n">public</span> <span class="nc">RouteResult</span> <span class="n">apply</span><span class="o">(</span><span class="nc">RequestContext</span> <span class="n">ctx</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">ctx</span><span class="o">.</span><span class="n">complete</span><span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="n">format</span><span class="o">(</span><span class="s">&quot;This was a %s request to %s&quot;</span><span class="o">,</span>
          <span class="n">ctx</span><span class="o">.</span><span class="n">request</span><span class="o">().</span><span class="n">method</span><span class="o">().</span><span class="n">value</span><span class="o">(),</span> <span class="n">ctx</span><span class="o">.</span><span class="n">request</span><span class="o">().</span><span class="n">getUri</span><span class="o">()));</span>
    <span class="o">}</span>
<span class="o">};</span>
<span class="nc">Handler</span> <span class="n">handlerResponse</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Handler</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">static</span> <span class="k">final</span> <span class="n">long</span> <span class="n">serialVersionUID</span> <span class="k">=</span> <span class="mi">1L</span><span class="o">;</span>
    <span class="nd">@Override</span>
    <span class="n">public</span> <span class="nc">RouteResult</span> <span class="n">apply</span><span class="o">(</span><span class="nc">RequestContext</span> <span class="n">ctx</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// with full control over the returned HttpResponse:</span>
        <span class="k">final</span> <span class="nc">HttpResponse</span> <span class="n">response</span> <span class="k">=</span> <span class="nc">HttpResponse</span><span class="o">.</span><span class="n">create</span><span class="o">()</span>
            <span class="o">.</span><span class="n">withEntity</span><span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="n">format</span><span class="o">(</span><span class="s">&quot;Accepted %s request to %s&quot;</span><span class="o">,</span>
              <span class="n">ctx</span><span class="o">.</span><span class="n">request</span><span class="o">().</span><span class="n">method</span><span class="o">().</span><span class="n">value</span><span class="o">(),</span> <span class="n">ctx</span><span class="o">.</span><span class="n">request</span><span class="o">().</span><span class="n">getUri</span><span class="o">()))</span>
            <span class="o">.</span><span class="n">withStatus</span><span class="o">(</span><span class="nc">StatusCodes</span><span class="o">.</span><span class="nc">ACCEPTED</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">ctx</span><span class="o">.</span><span class="n">complete</span><span class="o">(</span><span class="n">response</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">};</span>
</pre></div>
</div>
<p>The handler can include any kind of logic but must return a <tt class="docutils literal"><span class="pre">RouteResult</span></tt> in the end which can only
be created by using one of the <tt class="docutils literal"><span class="pre">RequestContext</span></tt> methods.</p>
<p>A handler instance can be used once or several times as shown in the full example:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">class</span> <span class="nc">TestHandler</span> <span class="k">extends</span> <span class="n">akka</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">javadsl</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="nc">AllDirectives</span> <span class="o">{</span>
    <span class="nc">Handler</span> <span class="n">handlerString</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Handler</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">static</span> <span class="k">final</span> <span class="n">long</span> <span class="n">serialVersionUID</span> <span class="k">=</span> <span class="mi">1L</span><span class="o">;</span>
        <span class="nd">@Override</span>
        <span class="n">public</span> <span class="nc">RouteResult</span> <span class="n">apply</span><span class="o">(</span><span class="nc">RequestContext</span> <span class="n">ctx</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">ctx</span><span class="o">.</span><span class="n">complete</span><span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="n">format</span><span class="o">(</span><span class="s">&quot;This was a %s request to %s&quot;</span><span class="o">,</span>
              <span class="n">ctx</span><span class="o">.</span><span class="n">request</span><span class="o">().</span><span class="n">method</span><span class="o">().</span><span class="n">value</span><span class="o">(),</span> <span class="n">ctx</span><span class="o">.</span><span class="n">request</span><span class="o">().</span><span class="n">getUri</span><span class="o">()));</span>
        <span class="o">}</span>
    <span class="o">};</span>
    <span class="nc">Handler</span> <span class="n">handlerResponse</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Handler</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">static</span> <span class="k">final</span> <span class="n">long</span> <span class="n">serialVersionUID</span> <span class="k">=</span> <span class="mi">1L</span><span class="o">;</span>
        <span class="nd">@Override</span>
        <span class="n">public</span> <span class="nc">RouteResult</span> <span class="n">apply</span><span class="o">(</span><span class="nc">RequestContext</span> <span class="n">ctx</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// with full control over the returned HttpResponse:</span>
            <span class="k">final</span> <span class="nc">HttpResponse</span> <span class="n">response</span> <span class="k">=</span> <span class="nc">HttpResponse</span><span class="o">.</span><span class="n">create</span><span class="o">()</span>
                <span class="o">.</span><span class="n">withEntity</span><span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="n">format</span><span class="o">(</span><span class="s">&quot;Accepted %s request to %s&quot;</span><span class="o">,</span>
                  <span class="n">ctx</span><span class="o">.</span><span class="n">request</span><span class="o">().</span><span class="n">method</span><span class="o">().</span><span class="n">value</span><span class="o">(),</span> <span class="n">ctx</span><span class="o">.</span><span class="n">request</span><span class="o">().</span><span class="n">getUri</span><span class="o">()))</span>
                <span class="o">.</span><span class="n">withStatus</span><span class="o">(</span><span class="nc">StatusCodes</span><span class="o">.</span><span class="nc">ACCEPTED</span><span class="o">);</span>
            <span class="k">return</span> <span class="n">ctx</span><span class="o">.</span><span class="n">complete</span><span class="o">(</span><span class="n">response</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">};</span>

    <span class="nc">Route</span> <span class="n">createRoute</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">route</span><span class="o">(</span>
            <span class="n">get</span><span class="o">(</span>
                <span class="n">handleWith</span><span class="o">(</span><span class="n">handlerString</span><span class="o">)</span>
            <span class="o">),</span>
            <span class="n">post</span><span class="o">(</span>
                <span class="n">path</span><span class="o">(</span><span class="s">&quot;abc&quot;</span><span class="o">).</span><span class="n">route</span><span class="o">(</span>
                    <span class="n">handleWith</span><span class="o">(</span><span class="n">handlerResponse</span><span class="o">)</span>
                <span class="o">)</span>
            <span class="o">)</span>
        <span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// actual testing code</span>
<span class="nc">TestRoute</span> <span class="n">r</span> <span class="k">=</span> <span class="n">testRoute</span><span class="o">(</span><span class="k">new</span> <span class="nc">TestHandler</span><span class="o">().</span><span class="n">createRoute</span><span class="o">());</span>
<span class="n">r</span><span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="nc">HttpRequest</span><span class="o">.</span><span class="nc">GET</span><span class="o">(</span><span class="s">&quot;/test&quot;</span><span class="o">))</span>
    <span class="o">.</span><span class="n">assertStatusCode</span><span class="o">(</span><span class="mi">200</span><span class="o">)</span>
    <span class="o">.</span><span class="n">assertEntity</span><span class="o">(</span><span class="s">&quot;This was a GET request to http://example.com/test&quot;</span><span class="o">);</span>

<span class="n">r</span><span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="nc">HttpRequest</span><span class="o">.</span><span class="nc">POST</span><span class="o">(</span><span class="s">&quot;/test&quot;</span><span class="o">))</span>
    <span class="o">.</span><span class="n">assertStatusCode</span><span class="o">(</span><span class="mi">404</span><span class="o">);</span>

<span class="n">r</span><span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="nc">HttpRequest</span><span class="o">.</span><span class="nc">POST</span><span class="o">(</span><span class="s">&quot;/abc&quot;</span><span class="o">))</span>
    <span class="o">.</span><span class="n">assertStatusCode</span><span class="o">(</span><span class="mi">202</span><span class="o">)</span>
    <span class="o">.</span><span class="n">assertEntity</span><span class="o">(</span><span class="s">&quot;Accepted POST request to http://example.com/abc&quot;</span><span class="o">);</span>
</pre></div>
</div>
</div>
<div class="section" id="handlers-and-request-values">
<h2>Handlers and Request Values</h2>
<p>In many cases, instead of manually inspecting the request, a handler will make use of <a class="reference internal" href="request-vals/index.html#request-vals-java"><em>Request values</em></a>
to extract details from the request. This is possible using one of the other <tt class="docutils literal"><span class="pre">handleWith</span></tt> overloads that bind
the values of one or more request values with a <tt class="docutils literal"><span class="pre">HandlerN</span></tt> instance to produce a <tt class="docutils literal"><span class="pre">Route</span></tt>:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">final</span> <span class="nc">Handler2</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">,</span> <span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">multiply</span> <span class="k">=</span>
    <span class="k">new</span> <span class="nc">Handler2</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">,</span> <span class="nc">Integer</span><span class="o">&gt;()</span> <span class="o">{</span>
        <span class="n">static</span> <span class="k">final</span> <span class="n">long</span> <span class="n">serialVersionUID</span> <span class="k">=</span> <span class="mi">1L</span><span class="o">;</span>
        <span class="nd">@Override</span>
        <span class="n">public</span> <span class="nc">RouteResult</span> <span class="n">apply</span><span class="o">(</span><span class="nc">RequestContext</span> <span class="n">ctx</span><span class="o">,</span> <span class="nc">Integer</span> <span class="n">x</span><span class="o">,</span> <span class="nc">Integer</span> <span class="n">y</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">int</span> <span class="n">result</span> <span class="k">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span><span class="o">;</span>
            <span class="k">return</span> <span class="n">ctx</span><span class="o">.</span><span class="n">complete</span><span class="o">(</span><span class="s">&quot;x * y = &quot;</span> <span class="o">+</span> <span class="n">result</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">};</span>

<span class="k">final</span> <span class="nc">Route</span> <span class="n">multiplyXAndYParam</span> <span class="k">=</span> <span class="n">handleWith2</span><span class="o">(</span><span class="n">xParam</span><span class="o">,</span> <span class="n">yParam</span><span class="o">,</span> <span class="n">multiply</span><span class="o">);</span>
</pre></div>
</div>
<p>The handler here implements multiplication of two integers. However, it doesn't need to specify where these
parameters come from. In <tt class="docutils literal"><span class="pre">handleWith</span></tt>, as many request values of the matching type have to be specified as the
handler needs. This can be seen in the full example:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">class</span> <span class="nc">TestHandler</span> <span class="k">extends</span> <span class="n">akka</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">javadsl</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="nc">AllDirectives</span> <span class="o">{</span>
    <span class="k">final</span> <span class="nc">RequestVal</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">xParam</span> <span class="k">=</span> <span class="nc">Parameters</span><span class="o">.</span><span class="n">intValue</span><span class="o">(</span><span class="s">&quot;x&quot;</span><span class="o">);</span>
    <span class="k">final</span> <span class="nc">RequestVal</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">yParam</span> <span class="k">=</span> <span class="nc">Parameters</span><span class="o">.</span><span class="n">intValue</span><span class="o">(</span><span class="s">&quot;y&quot;</span><span class="o">);</span>

    <span class="k">final</span> <span class="nc">RequestVal</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">xSegment</span> <span class="k">=</span> <span class="nc">PathMatchers</span><span class="o">.</span><span class="n">intValue</span><span class="o">();</span>
    <span class="k">final</span> <span class="nc">RequestVal</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">ySegment</span> <span class="k">=</span> <span class="nc">PathMatchers</span><span class="o">.</span><span class="n">intValue</span><span class="o">();</span>

    <span class="k">final</span> <span class="nc">Handler2</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">,</span> <span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">multiply</span> <span class="k">=</span>
        <span class="k">new</span> <span class="nc">Handler2</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">,</span> <span class="nc">Integer</span><span class="o">&gt;()</span> <span class="o">{</span>
            <span class="n">static</span> <span class="k">final</span> <span class="n">long</span> <span class="n">serialVersionUID</span> <span class="k">=</span> <span class="mi">1L</span><span class="o">;</span>
            <span class="nd">@Override</span>
            <span class="n">public</span> <span class="nc">RouteResult</span> <span class="n">apply</span><span class="o">(</span><span class="nc">RequestContext</span> <span class="n">ctx</span><span class="o">,</span> <span class="nc">Integer</span> <span class="n">x</span><span class="o">,</span> <span class="nc">Integer</span> <span class="n">y</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">int</span> <span class="n">result</span> <span class="k">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span><span class="o">;</span>
                <span class="k">return</span> <span class="n">ctx</span><span class="o">.</span><span class="n">complete</span><span class="o">(</span><span class="s">&quot;x * y = &quot;</span> <span class="o">+</span> <span class="n">result</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">};</span>

    <span class="k">final</span> <span class="nc">Route</span> <span class="n">multiplyXAndYParam</span> <span class="k">=</span> <span class="n">handleWith2</span><span class="o">(</span><span class="n">xParam</span><span class="o">,</span> <span class="n">yParam</span><span class="o">,</span> <span class="n">multiply</span><span class="o">);</span>

    <span class="nc">Route</span> <span class="n">createRoute</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">route</span><span class="o">(</span>
            <span class="n">get</span><span class="o">(</span>
                <span class="n">pathPrefix</span><span class="o">(</span><span class="s">&quot;calculator&quot;</span><span class="o">).</span><span class="n">route</span><span class="o">(</span>
                    <span class="n">path</span><span class="o">(</span><span class="s">&quot;multiply&quot;</span><span class="o">).</span><span class="n">route</span><span class="o">(</span>
                        <span class="n">multiplyXAndYParam</span>
                    <span class="o">),</span>
                    <span class="n">path</span><span class="o">(</span><span class="s">&quot;path-multiply&quot;</span><span class="o">,</span> <span class="n">xSegment</span><span class="o">,</span> <span class="n">ySegment</span><span class="o">).</span><span class="n">route</span><span class="o">(</span>
                        <span class="n">handleWith2</span><span class="o">(</span><span class="n">xSegment</span><span class="o">,</span> <span class="n">ySegment</span><span class="o">,</span> <span class="n">multiply</span><span class="o">)</span>
                    <span class="o">)</span>
                <span class="o">)</span>
            <span class="o">)</span>
        <span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// actual testing code</span>
<span class="nc">TestRoute</span> <span class="n">r</span> <span class="k">=</span> <span class="n">testRoute</span><span class="o">(</span><span class="k">new</span> <span class="nc">TestHandler</span><span class="o">().</span><span class="n">createRoute</span><span class="o">());</span>
<span class="n">r</span><span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="nc">HttpRequest</span><span class="o">.</span><span class="nc">GET</span><span class="o">(</span><span class="s">&quot;/calculator/multiply?x=12&amp;y=42&quot;</span><span class="o">))</span>
    <span class="o">.</span><span class="n">assertStatusCode</span><span class="o">(</span><span class="mi">200</span><span class="o">)</span>
    <span class="o">.</span><span class="n">assertEntity</span><span class="o">(</span><span class="s">&quot;x * y = 504&quot;</span><span class="o">);</span>

<span class="n">r</span><span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="nc">HttpRequest</span><span class="o">.</span><span class="nc">GET</span><span class="o">(</span><span class="s">&quot;/calculator/path-multiply/23/5&quot;</span><span class="o">))</span>
    <span class="o">.</span><span class="n">assertStatusCode</span><span class="o">(</span><span class="mi">200</span><span class="o">)</span>
    <span class="o">.</span><span class="n">assertEntity</span><span class="o">(</span><span class="s">&quot;x * y = 115&quot;</span><span class="o">);</span>
</pre></div>
</div>
<p>Here, the handler is again being reused. First, in creating a route that expects URI parameters <tt class="docutils literal"><span class="pre">x</span></tt> and <tt class="docutils literal"><span class="pre">y</span></tt>. This
route is then used in the route structure. And second, the handler is used with another set of <tt class="docutils literal"><span class="pre">RequestVal</span></tt> in the
route structure, this time representing segments from the URI path.</p>
</div>
<div class="section" id="handlers-in-java-8">
<h2>Handlers in Java 8</h2>
<p>Handlers are in fact simply classes which extend <tt class="docutils literal"><span class="pre">akka.japi.function.FunctionN</span></tt> in order to make reasoning
about the number of handled arguments easier. For example, a <tt class="xref py py-class docutils literal"><span class="pre">Handler1[String]</span></tt> is simply a
<tt class="docutils literal"><span class="pre">Function2[RequestContext,</span> <span class="pre">String,</span> <span class="pre">RouteResult]</span></tt>. You can think of handlers as hot-dogs, where each <tt class="docutils literal"><span class="pre">T</span></tt>
type represents a sausage, put between the &quot;buns&quot; which are <tt class="docutils literal"><span class="pre">RequestContext</span></tt> and <tt class="docutils literal"><span class="pre">RouteResult</span></tt>.</p>
<p>In Java 8 handlers can be provided as function literals or method references. The previous example can then be written
like this:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">class</span> <span class="nc">TestHandler</span> <span class="k">extends</span> <span class="n">akka</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">javadsl</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="nc">AllDirectives</span> <span class="o">{</span>
    <span class="k">final</span> <span class="nc">RequestVal</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">xParam</span> <span class="k">=</span> <span class="nc">Parameters</span><span class="o">.</span><span class="n">intValue</span><span class="o">(</span><span class="s">&quot;x&quot;</span><span class="o">);</span>
    <span class="k">final</span> <span class="nc">RequestVal</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">yParam</span> <span class="k">=</span> <span class="nc">Parameters</span><span class="o">.</span><span class="n">intValue</span><span class="o">(</span><span class="s">&quot;y&quot;</span><span class="o">);</span>

    <span class="k">final</span> <span class="nc">Handler2</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">,</span> <span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">multiply</span> <span class="k">=</span>
            <span class="o">(</span><span class="n">ctx</span><span class="o">,</span> <span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">ctx</span><span class="o">.</span><span class="n">complete</span><span class="o">(</span><span class="s">&quot;x * y = &quot;</span> <span class="o">+</span> <span class="o">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">y</span><span class="o">));</span>

    <span class="k">final</span> <span class="nc">Route</span> <span class="n">multiplyXAndYParam</span> <span class="k">=</span> <span class="n">handleWith2</span><span class="o">(</span><span class="n">xParam</span><span class="o">,</span> <span class="n">yParam</span><span class="o">,</span> <span class="n">multiply</span><span class="o">);</span>

    <span class="nc">RouteResult</span> <span class="n">subtract</span><span class="o">(</span><span class="nc">RequestContext</span> <span class="n">ctx</span><span class="o">,</span> <span class="n">int</span> <span class="n">x</span><span class="o">,</span> <span class="n">int</span> <span class="n">y</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">ctx</span><span class="o">.</span><span class="n">complete</span><span class="o">(</span><span class="s">&quot;x - y = &quot;</span> <span class="o">+</span> <span class="o">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">y</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="nc">Route</span> <span class="n">createRoute</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">route</span><span class="o">(</span>
            <span class="n">get</span><span class="o">(</span>
                <span class="n">pathPrefix</span><span class="o">(</span><span class="s">&quot;calculator&quot;</span><span class="o">).</span><span class="n">route</span><span class="o">(</span>
                    <span class="n">path</span><span class="o">(</span><span class="s">&quot;multiply&quot;</span><span class="o">).</span><span class="n">route</span><span class="o">(</span>
                        <span class="c1">// use Handler explicitly</span>
                        <span class="n">multiplyXAndYParam</span>
                    <span class="o">),</span>
                    <span class="n">path</span><span class="o">(</span><span class="s">&quot;add&quot;</span><span class="o">).</span><span class="n">route</span><span class="o">(</span>
                        <span class="c1">// create Handler as lambda expression</span>
                        <span class="n">handleWith2</span><span class="o">(</span><span class="n">xParam</span><span class="o">,</span> <span class="n">yParam</span><span class="o">,</span>
                                <span class="o">(</span><span class="n">ctx</span><span class="o">,</span> <span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">ctx</span><span class="o">.</span><span class="n">complete</span><span class="o">(</span><span class="s">&quot;x + y = &quot;</span> <span class="o">+</span> <span class="o">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="o">)))</span>
                    <span class="o">),</span>
                    <span class="n">path</span><span class="o">(</span><span class="s">&quot;subtract&quot;</span><span class="o">).</span><span class="n">route</span><span class="o">(</span>
                        <span class="c1">// create handler by lifting method</span>
                        <span class="n">handleWith2</span><span class="o">(</span><span class="n">xParam</span><span class="o">,</span> <span class="n">yParam</span><span class="o">,</span> <span class="k">this</span><span class="o">::</span><span class="n">subtract</span><span class="o">)</span>
                    <span class="o">)</span>
                <span class="o">)</span>
            <span class="o">)</span>
        <span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// actual testing code</span>
<span class="nc">TestRoute</span> <span class="n">r</span> <span class="k">=</span> <span class="n">testRoute</span><span class="o">(</span><span class="k">new</span> <span class="nc">TestHandler</span><span class="o">().</span><span class="n">createRoute</span><span class="o">());</span>
<span class="n">r</span><span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="nc">HttpRequest</span><span class="o">.</span><span class="nc">GET</span><span class="o">(</span><span class="s">&quot;/calculator/multiply?x=12&amp;y=42&quot;</span><span class="o">))</span>
        <span class="o">.</span><span class="n">assertStatusCode</span><span class="o">(</span><span class="mi">200</span><span class="o">)</span>
        <span class="o">.</span><span class="n">assertEntity</span><span class="o">(</span><span class="s">&quot;x * y = 504&quot;</span><span class="o">);</span>

<span class="n">r</span><span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="nc">HttpRequest</span><span class="o">.</span><span class="nc">GET</span><span class="o">(</span><span class="s">&quot;/calculator/add?x=12&amp;y=42&quot;</span><span class="o">))</span>
        <span class="o">.</span><span class="n">assertStatusCode</span><span class="o">(</span><span class="mi">200</span><span class="o">)</span>
        <span class="o">.</span><span class="n">assertEntity</span><span class="o">(</span><span class="s">&quot;x + y = 54&quot;</span><span class="o">);</span>

<span class="n">r</span><span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="nc">HttpRequest</span><span class="o">.</span><span class="nc">GET</span><span class="o">(</span><span class="s">&quot;/calculator/subtract?x=42&amp;y=12&quot;</span><span class="o">))</span>
        <span class="o">.</span><span class="n">assertStatusCode</span><span class="o">(</span><span class="mi">200</span><span class="o">)</span>
        <span class="o">.</span><span class="n">assertEntity</span><span class="o">(</span><span class="s">&quot;x - y = 30&quot;</span><span class="o">);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>The reason the <tt class="docutils literal"><span class="pre">handleWith##</span></tt> methods include the number of handled values is because otherwise (if overloading would
be used, for all 22 methods) error messages generated by <tt class="docutils literal"><span class="pre">javac</span></tt> end up being very long and not readable, i.e.
if one type of a handler does not match the given values, <em>all</em> possible candidates would be printed in the error message
(22 of them), instead of just the one arity-matching method, pointing out that the type does not match.</p>
<p class="last">We opted for better error messages as we feel this is more helpful when developing applications,
instead of having one overloaded method which looks nice when everything works, but procudes hard to read error
messages if something does not match up.</p>
</div>
</div>
<div class="section" id="providing-handlers-by-reflection">
<h2>Providing Handlers by Reflection</h2>
<p>Using Java before Java 8, writing out handlers as (anonymous) classes can be unwieldy. Therefore, <tt class="docutils literal"><span class="pre">handleReflectively</span></tt>
overloads are provided that allow writing handler as simple methods and specifying them by name:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="n">public</span> <span class="nc">RouteResult</span> <span class="n">multiply</span><span class="o">(</span><span class="nc">RequestContext</span> <span class="n">ctx</span><span class="o">,</span> <span class="nc">Integer</span> <span class="n">x</span><span class="o">,</span> <span class="nc">Integer</span> <span class="n">y</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">int</span> <span class="n">result</span> <span class="k">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span><span class="o">;</span>
    <span class="k">return</span> <span class="n">ctx</span><span class="o">.</span><span class="n">complete</span><span class="o">(</span><span class="s">&quot;x * y = &quot;</span> <span class="o">+</span> <span class="n">result</span><span class="o">);</span>
<span class="o">}</span>

<span class="nc">Route</span> <span class="n">multiplyXAndYParam</span> <span class="k">=</span> <span class="n">handleReflectively</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="s">&quot;multiply&quot;</span><span class="o">,</span> <span class="n">xParam</span><span class="o">,</span> <span class="n">yParam</span><span class="o">);</span>
</pre></div>
</div>
<p>The complete calculator example can then be written like this:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">class</span> <span class="nc">TestHandler</span> <span class="k">extends</span> <span class="n">akka</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">javadsl</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="nc">AllDirectives</span> <span class="o">{</span>
    <span class="nc">RequestVal</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">xParam</span> <span class="k">=</span> <span class="nc">Parameters</span><span class="o">.</span><span class="n">intValue</span><span class="o">(</span><span class="s">&quot;x&quot;</span><span class="o">);</span>
    <span class="nc">RequestVal</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">yParam</span> <span class="k">=</span> <span class="nc">Parameters</span><span class="o">.</span><span class="n">intValue</span><span class="o">(</span><span class="s">&quot;y&quot;</span><span class="o">);</span>

    <span class="nc">RequestVal</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">xSegment</span> <span class="k">=</span> <span class="nc">PathMatchers</span><span class="o">.</span><span class="n">intValue</span><span class="o">();</span>
    <span class="nc">RequestVal</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">ySegment</span> <span class="k">=</span> <span class="nc">PathMatchers</span><span class="o">.</span><span class="n">intValue</span><span class="o">();</span>


    <span class="n">public</span> <span class="nc">RouteResult</span> <span class="n">multiply</span><span class="o">(</span><span class="nc">RequestContext</span> <span class="n">ctx</span><span class="o">,</span> <span class="nc">Integer</span> <span class="n">x</span><span class="o">,</span> <span class="nc">Integer</span> <span class="n">y</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">int</span> <span class="n">result</span> <span class="k">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">ctx</span><span class="o">.</span><span class="n">complete</span><span class="o">(</span><span class="s">&quot;x * y = &quot;</span> <span class="o">+</span> <span class="n">result</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nc">Route</span> <span class="n">multiplyXAndYParam</span> <span class="k">=</span> <span class="n">handleReflectively</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="s">&quot;multiply&quot;</span><span class="o">,</span> <span class="n">xParam</span><span class="o">,</span> <span class="n">yParam</span><span class="o">);</span>

    <span class="nc">Route</span> <span class="n">createRoute</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">route</span><span class="o">(</span>
            <span class="n">get</span><span class="o">(</span>
                <span class="n">pathPrefix</span><span class="o">(</span><span class="s">&quot;calculator&quot;</span><span class="o">).</span><span class="n">route</span><span class="o">(</span>
                    <span class="n">path</span><span class="o">(</span><span class="s">&quot;multiply&quot;</span><span class="o">).</span><span class="n">route</span><span class="o">(</span>
                        <span class="n">multiplyXAndYParam</span>
                    <span class="o">),</span>
                    <span class="n">path</span><span class="o">(</span><span class="s">&quot;path-multiply&quot;</span><span class="o">,</span> <span class="n">xSegment</span><span class="o">,</span> <span class="n">ySegment</span><span class="o">).</span><span class="n">route</span><span class="o">(</span>
                        <span class="n">handleWith2</span><span class="o">(</span><span class="n">xSegment</span><span class="o">,</span> <span class="n">ySegment</span><span class="o">,</span> <span class="k">this</span><span class="o">::</span><span class="n">multiply</span><span class="o">)</span>
                    <span class="o">)</span>
                <span class="o">)</span>
            <span class="o">)</span>
        <span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// actual testing code</span>
<span class="nc">TestRoute</span> <span class="n">r</span> <span class="k">=</span> <span class="n">testRoute</span><span class="o">(</span><span class="k">new</span> <span class="nc">TestHandler</span><span class="o">().</span><span class="n">createRoute</span><span class="o">());</span>
<span class="n">r</span><span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="nc">HttpRequest</span><span class="o">.</span><span class="nc">GET</span><span class="o">(</span><span class="s">&quot;/calculator/multiply?x=12&amp;y=42&quot;</span><span class="o">))</span>
    <span class="o">.</span><span class="n">assertStatusCode</span><span class="o">(</span><span class="mi">200</span><span class="o">)</span>
    <span class="o">.</span><span class="n">assertEntity</span><span class="o">(</span><span class="s">&quot;x * y = 504&quot;</span><span class="o">);</span>

<span class="n">r</span><span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="nc">HttpRequest</span><span class="o">.</span><span class="nc">GET</span><span class="o">(</span><span class="s">&quot;/calculator/path-multiply/23/5&quot;</span><span class="o">))</span>
    <span class="o">.</span><span class="n">assertStatusCode</span><span class="o">(</span><span class="mi">200</span><span class="o">)</span>
    <span class="o">.</span><span class="n">assertEntity</span><span class="o">(</span><span class="s">&quot;x * y = 115&quot;</span><span class="o">);</span>
</pre></div>
</div>
<p>There are alternative overloads for <tt class="docutils literal"><span class="pre">handleReflectively</span></tt> that take a <tt class="docutils literal"><span class="pre">Class</span></tt> instead of an object instance to refer to
static methods. The referenced method must be publicly accessible.</p>
</div>
<div class="section" id="deferring-result-creation">
<h2>Deferring Result Creation</h2>
<p>Sometimes a handler cannot directly complete the request but needs to do some processing asynchronously. In this case
the completion of a request needs to be deferred until the result has been generated. This is supported by the routing
DSL in two ways: either you can use one of the <tt class="docutils literal"><span class="pre">handleWithAsyncN</span></tt> methods passing an <tt class="docutils literal"><span class="pre">AsyncHandlerN</span></tt> which
returns a <tt class="docutils literal"><span class="pre">CompletionStage&lt;RouteResult&gt;</span></tt>, i.e. an eventual <tt class="docutils literal"><span class="pre">RouteResult</span></tt>, or you can also use a regular handler as shown
above and use <tt class="docutils literal"><span class="pre">RequestContext.completeWith</span></tt> for completion which takes an <tt class="docutils literal"><span class="pre">CompletionStage&lt;RouteResult&gt;</span></tt> as an argument.</p>
<p>This is demonstrated in the following example. Consider a asynchronous service defined like this
(making use of Java 8 lambdas):</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">class</span> <span class="nc">CalculatorService</span> <span class="o">{</span>
    <span class="n">public</span> <span class="nc">CompletionStage</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">multiply</span><span class="o">(</span><span class="k">final</span> <span class="n">int</span> <span class="n">x</span><span class="o">,</span> <span class="k">final</span> <span class="n">int</span> <span class="n">y</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">CompletableFuture</span><span class="o">.</span><span class="n">supplyAsync</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="n">public</span> <span class="nc">CompletionStage</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">add</span><span class="o">(</span><span class="k">final</span> <span class="n">int</span> <span class="n">x</span><span class="o">,</span> <span class="k">final</span> <span class="n">int</span> <span class="n">y</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">CompletableFuture</span><span class="o">.</span><span class="n">supplyAsync</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Here the calculator runs the actual calculation in the background and only eventually returns the result. The HTTP
service should provide a front-end to that service without having to block while waiting for the results. As explained
above this can be done in two ways.</p>
<p>First, you can use <tt class="docutils literal"><span class="pre">handleWithAsyncN</span></tt> to be able to return a <tt class="docutils literal"><span class="pre">CompletionStage&lt;RouteResult&gt;</span></tt>:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="c1">// would probably be injected or passed at construction time in real code</span>
<span class="nc">CalculatorService</span> <span class="n">calculatorService</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">CalculatorService</span><span class="o">();</span>
<span class="n">public</span> <span class="nc">CompletionStage</span><span class="o">&lt;</span><span class="nc">RouteResult</span><span class="o">&gt;</span> <span class="n">multiplyAsync</span><span class="o">(</span><span class="k">final</span> <span class="nc">RequestContext</span> <span class="n">ctx</span><span class="o">,</span> <span class="n">int</span> <span class="n">x</span><span class="o">,</span> <span class="n">int</span> <span class="n">y</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">CompletionStage</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">result</span> <span class="k">=</span> <span class="n">calculatorService</span><span class="o">.</span><span class="n">multiply</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">thenApplyAsync</span><span class="o">(</span><span class="n">product</span> <span class="o">-&gt;</span> <span class="n">ctx</span><span class="o">.</span><span class="n">complete</span><span class="o">(</span><span class="s">&quot;x * y = &quot;</span> <span class="o">+</span> <span class="n">product</span><span class="o">),</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">executionContext</span><span class="o">());</span>
<span class="o">}</span>
<span class="nc">Route</span> <span class="n">multiplyAsyncRoute</span> <span class="k">=</span>
    <span class="n">path</span><span class="o">(</span><span class="s">&quot;multiply&quot;</span><span class="o">).</span><span class="n">route</span><span class="o">(</span>
        <span class="n">handleWithAsync2</span><span class="o">(</span><span class="n">xParam</span><span class="o">,</span> <span class="n">yParam</span><span class="o">,</span> <span class="k">this</span><span class="o">::</span><span class="n">multiplyAsync</span><span class="o">)</span>
    <span class="o">);</span>
</pre></div>
</div>
<p>The handler invokes the service and then maps the calculation result to a <tt class="docutils literal"><span class="pre">RouteResult</span></tt> using <tt class="docutils literal"><span class="pre">CompletionStage.thenApplyAsync</span></tt> and
returns the resulting <tt class="docutils literal"><span class="pre">CompletionStage&lt;RouteResult&gt;</span></tt>. Note that you should always explicitly provide an executor that designates
where the future transformation task is executed, using the JDK’s global ForkJoinPool is not recommended.</p>
<p>Otherwise, you can also still use <tt class="docutils literal"><span class="pre">handleWithN</span></tt> and use <tt class="docutils literal"><span class="pre">RequestContext.completeWith</span></tt> to &quot;convert&quot; a
<tt class="docutils literal"><span class="pre">CompletionStage&lt;RouteResult&gt;</span></tt> into a <tt class="docutils literal"><span class="pre">RouteResult</span></tt> as shown here:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="n">public</span> <span class="nc">RouteResult</span> <span class="n">addAsync</span><span class="o">(</span><span class="k">final</span> <span class="nc">RequestContext</span> <span class="n">ctx</span><span class="o">,</span> <span class="n">int</span> <span class="n">x</span><span class="o">,</span> <span class="n">int</span> <span class="n">y</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">CompletionStage</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">result</span> <span class="k">=</span> <span class="n">calculatorService</span><span class="o">.</span><span class="n">add</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">ctx</span><span class="o">.</span><span class="n">completeWith</span><span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="n">thenApplyAsync</span><span class="o">(</span><span class="n">sum</span> <span class="o">-&gt;</span> <span class="n">ctx</span><span class="o">.</span><span class="n">complete</span><span class="o">(</span><span class="s">&quot;x + y = &quot;</span> <span class="o">+</span> <span class="n">sum</span><span class="o">),</span>
        <span class="n">ctx</span><span class="o">.</span><span class="n">executionContext</span><span class="o">()));</span>
<span class="o">}</span>
<span class="nc">Route</span> <span class="n">addAsyncRoute</span> <span class="k">=</span>
    <span class="n">path</span><span class="o">(</span><span class="s">&quot;add&quot;</span><span class="o">).</span><span class="n">route</span><span class="o">(</span>
        <span class="n">handleWith2</span><span class="o">(</span><span class="n">xParam</span><span class="o">,</span> <span class="n">yParam</span><span class="o">,</span> <span class="k">this</span><span class="o">::</span><span class="n">addAsync</span><span class="o">)</span>
    <span class="o">);</span>
</pre></div>
</div>
<p>Using this style, you can decide in your handler if you want to return a direct synchronous result or if you need
to defer completion.</p>
<p>Both alternatives will not block and show the same runtime behavior.</p>
<p>Here's the complete example:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">class</span> <span class="nc">CalculatorService</span> <span class="o">{</span>
    <span class="n">public</span> <span class="nc">CompletionStage</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">multiply</span><span class="o">(</span><span class="k">final</span> <span class="n">int</span> <span class="n">x</span><span class="o">,</span> <span class="k">final</span> <span class="n">int</span> <span class="n">y</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">CompletableFuture</span><span class="o">.</span><span class="n">supplyAsync</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="n">public</span> <span class="nc">CompletionStage</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">add</span><span class="o">(</span><span class="k">final</span> <span class="n">int</span> <span class="n">x</span><span class="o">,</span> <span class="k">final</span> <span class="n">int</span> <span class="n">y</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">CompletableFuture</span><span class="o">.</span><span class="n">supplyAsync</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="k">class</span> <span class="nc">TestHandler</span> <span class="k">extends</span> <span class="n">akka</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">javadsl</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="nc">AllDirectives</span> <span class="o">{</span>
    <span class="nc">RequestVal</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">xParam</span> <span class="k">=</span> <span class="nc">Parameters</span><span class="o">.</span><span class="n">intValue</span><span class="o">(</span><span class="s">&quot;x&quot;</span><span class="o">);</span>
    <span class="nc">RequestVal</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">yParam</span> <span class="k">=</span> <span class="nc">Parameters</span><span class="o">.</span><span class="n">intValue</span><span class="o">(</span><span class="s">&quot;y&quot;</span><span class="o">);</span>

    <span class="c1">// would probably be injected or passed at construction time in real code</span>
    <span class="nc">CalculatorService</span> <span class="n">calculatorService</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">CalculatorService</span><span class="o">();</span>
    <span class="n">public</span> <span class="nc">CompletionStage</span><span class="o">&lt;</span><span class="nc">RouteResult</span><span class="o">&gt;</span> <span class="n">multiplyAsync</span><span class="o">(</span><span class="k">final</span> <span class="nc">RequestContext</span> <span class="n">ctx</span><span class="o">,</span> <span class="n">int</span> <span class="n">x</span><span class="o">,</span> <span class="n">int</span> <span class="n">y</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">CompletionStage</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">result</span> <span class="k">=</span> <span class="n">calculatorService</span><span class="o">.</span><span class="n">multiply</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">thenApplyAsync</span><span class="o">(</span><span class="n">product</span> <span class="o">-&gt;</span> <span class="n">ctx</span><span class="o">.</span><span class="n">complete</span><span class="o">(</span><span class="s">&quot;x * y = &quot;</span> <span class="o">+</span> <span class="n">product</span><span class="o">),</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">executionContext</span><span class="o">());</span>
    <span class="o">}</span>
    <span class="nc">Route</span> <span class="n">multiplyAsyncRoute</span> <span class="k">=</span>
        <span class="n">path</span><span class="o">(</span><span class="s">&quot;multiply&quot;</span><span class="o">).</span><span class="n">route</span><span class="o">(</span>
            <span class="n">handleWithAsync2</span><span class="o">(</span><span class="n">xParam</span><span class="o">,</span> <span class="n">yParam</span><span class="o">,</span> <span class="k">this</span><span class="o">::</span><span class="n">multiplyAsync</span><span class="o">)</span>
        <span class="o">);</span>

    <span class="n">public</span> <span class="nc">RouteResult</span> <span class="n">addAsync</span><span class="o">(</span><span class="k">final</span> <span class="nc">RequestContext</span> <span class="n">ctx</span><span class="o">,</span> <span class="n">int</span> <span class="n">x</span><span class="o">,</span> <span class="n">int</span> <span class="n">y</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">CompletionStage</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">result</span> <span class="k">=</span> <span class="n">calculatorService</span><span class="o">.</span><span class="n">add</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">ctx</span><span class="o">.</span><span class="n">completeWith</span><span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="n">thenApplyAsync</span><span class="o">(</span><span class="n">sum</span> <span class="o">-&gt;</span> <span class="n">ctx</span><span class="o">.</span><span class="n">complete</span><span class="o">(</span><span class="s">&quot;x + y = &quot;</span> <span class="o">+</span> <span class="n">sum</span><span class="o">),</span>
            <span class="n">ctx</span><span class="o">.</span><span class="n">executionContext</span><span class="o">()));</span>
    <span class="o">}</span>
    <span class="nc">Route</span> <span class="n">addAsyncRoute</span> <span class="k">=</span>
        <span class="n">path</span><span class="o">(</span><span class="s">&quot;add&quot;</span><span class="o">).</span><span class="n">route</span><span class="o">(</span>
            <span class="n">handleWith2</span><span class="o">(</span><span class="n">xParam</span><span class="o">,</span> <span class="n">yParam</span><span class="o">,</span> <span class="k">this</span><span class="o">::</span><span class="n">addAsync</span><span class="o">)</span>
        <span class="o">);</span>

    <span class="nc">Route</span> <span class="n">createRoute</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">route</span><span class="o">(</span>
            <span class="n">get</span><span class="o">(</span>
                <span class="n">pathPrefix</span><span class="o">(</span><span class="s">&quot;calculator&quot;</span><span class="o">).</span><span class="n">route</span><span class="o">(</span>
                    <span class="n">multiplyAsyncRoute</span><span class="o">,</span>
                    <span class="n">addAsyncRoute</span>
                <span class="o">)</span>
            <span class="o">)</span>
        <span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// testing code</span>
<span class="nc">TestRoute</span> <span class="n">r</span> <span class="k">=</span> <span class="n">testRoute</span><span class="o">(</span><span class="k">new</span> <span class="nc">TestHandler</span><span class="o">().</span><span class="n">createRoute</span><span class="o">());</span>
<span class="n">r</span><span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="nc">HttpRequest</span><span class="o">.</span><span class="nc">GET</span><span class="o">(</span><span class="s">&quot;/calculator/multiply?x=12&amp;y=42&quot;</span><span class="o">))</span>
    <span class="o">.</span><span class="n">assertStatusCode</span><span class="o">(</span><span class="mi">200</span><span class="o">)</span>
    <span class="o">.</span><span class="n">assertEntity</span><span class="o">(</span><span class="s">&quot;x * y = 504&quot;</span><span class="o">);</span>

<span class="n">r</span><span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="nc">HttpRequest</span><span class="o">.</span><span class="nc">GET</span><span class="o">(</span><span class="s">&quot;/calculator/add?x=23&amp;y=5&quot;</span><span class="o">))</span>
    <span class="o">.</span><span class="n">assertStatusCode</span><span class="o">(</span><span class="mi">200</span><span class="o">)</span>
    <span class="o">.</span><span class="n">assertEntity</span><span class="o">(</span><span class="s">&quot;x + y = 28&quot;</span><span class="o">);</span>
</pre></div>
</div>
</div>
</div>


          </div>
          <div class="span3"><p class="contents-title">Contents</p>
              <div id="scroller-anchor">
                <div id="scroller">
                  <div id="toc"></div>
                </div>
              </div></div>
        </div>
      </div>
    </div>
  </div>
  <div class="footer">
  <div class="container">
    <ul>
      <li><h5>Akka</h5></li>
      <li><a href="http://akka.io/docs">Documentation</a></li>
      <li><a href="http://akka.io/faq">FAQ</a></li>
      <li><a href="http://akka.io/downloads">Downloads</a></li>
      <li><a href="http://akka.io/news">News</a></li>
      <li><a href="http://letitcrash.com">Blog</a></li>
    </ul>
    <ul>
      <li><h5>Contribute</h5></li>
      <li><a href="http://akka.io/community">Community Projects</a></li>
      <li><a href="http://github.com/akka/akka">Source Code</a></li>
      <li><a href="http://groups.google.com/group/akka-user">Mailing List</a></li>      
      <li><a href="http://doc.akka.io/docs/akka/current/project/issue-tracking.html">Report a Bug</a></li>      
    </ul>
    <ul>
      <li><h5>Company</h5></li>
      <li><a href="http://www.lightbend.com/how/subscription">Commercial Support</a></li>
      <li><a href="http://akka.io/team">Team</a></li>
      <li><a href="mailto:info@lightbend.com">Contact</a></li>
    </ul>
    <ul>
      <li><img src="../../../_static/akka_icon_reverse.svg" align="center"/></li>
    </ul>
  </div>
  <div class="container copyright">
    <p style="float: left;">
      © 2015 <a href="http://www.lightbend.com/">Lightbend Inc.</a> <span class="license">Akka is Open Source and available under the Apache 2 License.</span>
    </p>
    <p style="float: right; font-size: 12px;">
      Last updated: Apr 01, 2016
    </p>          
  </div>
</div>
<script type="text/javascript">
  var $toc = $('#toc');
  $toc.toc();

  // show clickable section sign when section header hovered:
  $('.section h2,.section h3,.section h4,.section h5').each(function(i, el) {
      var $el = $(el);
      $el.prepend($("<a class='section-marker' href='#" + $el.attr("id") + "'>&sect;</a>"))
  });
</script>

<!-- Algolia docs search -->
<script type="text/javascript">
  var version = DOCUMENTATION_OPTIONS.VERSION;

  var lang = "scala";
  var path = window.location.pathname;
  if (path.includes("/java/") || path.includes("java.html")) lang = "java";

  console.log("Search configured for:", lang, "@", version);

  docsearch({
    apiKey: '543bad5ad786495d9ccd445ed34ed082',
    indexName: 'akka_io',
    inputSelector: '#search',
    algoliaOptions: {
      hitsPerPage: 10,
      facetFilters: '[' +
      '["language:' + lang + '","language:general"]' +
      ',"version:2.4.2"]'
    }
  });

  // set up "/" as global shortcut for focusing on search
  $(document).keypress(function (event) {
    if (event.keyCode == 47) {
      $("#q").focus();
      return false; // swallow key event, otherwise the / char would be input into the search box
    }
  });
</script>

  

  </body>
</html>